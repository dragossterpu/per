<ui:composition template="../layouts/layoutInterior.xhtml" xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:p="http://primefaces.org/ui">
    <ui:define name="content">

        <ui:param name="esJefeEquipoInspeccion" value="#{request.remoteUser eq informeBean.informe.inspeccion.equipo.jefeEquipo.username or p:ifAnyGranted('JEFE_INSPECCIONES, ADMIN')}" />
                            
        <ui:param name="titulo" value="Modificar informe" />
        <f:event listener="#{navegacionBean.adelante(titulo, request.servletPath)}" type="preRenderView"/>
        <h3>#{titulo}</h3>
            
        <h:form id="informe">

			<p:accordionPanel value="#{informeBean.listaAreas}" var="area" activeIndex="-1" multiple="true">
				<p:tab title="#{area.descripcion}">
					<p:accordionPanel value="#{informeBean.mapaAreasSubareas[area]}" var="subarea" activeIndex="-1" multiple="true">
                        <p:tab id="tabsubarea" title="#{subarea.descripcion}">
                            <p:outputPanel rendered="#{informeBean.mapaAsignaciones[subarea] ne request.remoteUser}">
                                <h:outputText value="#{informeBean.mapaRespuestas[subarea][0]}" escape="false"/>
                                <h:outputFormat rendered="#{not empty informeBean.mapaRespuestas[subarea][1]}">
                                    <h5><h:outputText value="Conclusiones y propuestas."/></h5>
                                    <h:outputText value="#{informeBean.mapaRespuestas[subarea][1]}" escape="false"/>
                                </h:outputFormat>
                            </p:outputPanel>
                            
                            <h:outputText value="Asignado a: #{informeBean.mapaAsignaciones[subarea]}"  style="color:red;font-weight:bold;" rendered="#{not empty informeBean.mapaAsignaciones[subarea]}"/>
                            <p:commandButton value="Editar" actionListener="#{informeBean.asignarSubarea(subarea)}" update="tabsubarea" rendered="#{empty informeBean.mapaAsignaciones[subarea]}"/>
                            
                            <p:outputPanel rendered="#{informeBean.mapaAsignaciones[subarea] eq request.remoteUser}">
                                <p:textEditor id="editortexto" value="#{informeBean.mapaRespuestas[subarea][0]}" height="300" style="margin-bottom:10px" converter="#{trimConverter}"
                                    required="true" requiredMessage="No puede dejar un subárea sin responder.">
                                    <f:facet name="toolbar">
                                        <span class="ql-formats">
                                            <select class="ql-font" title="Tipo de letra"></select>
                                            <select class="ql-size" title="Tamaño de letra">
                                                <option value="small">Pequeña</option>
                                                <option selected="selected">Normal</option>
                                                <option value="large">Grande</option>
                                            </select>
                                        </span>
                                         <span class="ql-formats">
                                            <button class="ql-bold" title="Negrita"></button>
                                            <button class="ql-italic" title="Cursiva"></button>
                                            <button class="ql-underline" title="Subrayado"></button>
                                            <button class="ql-strike" title="Tachado"></button>
                                        </span>
                                        <span class="ql-formats">
                                            <select class="ql-color ql-picker ql-color-picker" title="Color letra"></select>
                                            <select class="ql-background ql-picker ql-color-picker" title="Color fondo"></select>
                                        </span>
                                        <span class="ql-formats">
                                            <button class="ql-script" value="sub" title="Subíndice"></button>
                                            <button class="ql-script" value="super" title="Superíndice"></button>
                                        </span>
                                        <span class="ql-formats">
                                            <select  class="ql-header" title="Encabezado">
                                                <option selected="selected">Normal</option>
                                                <option value="3">Título 3</option>
                                                <option value="4">Título 4</option>
                                            </select>
                                        </span>
                                        <span class="ql-formats">
                                            <button class="ql-list" value="ordered" title="Lista numerada"></button>
                                            <button class="ql-list" value="bullet" title="Lista no numerada"></button>
                                            <button class="ql-indent" value="-1" title="Disminuir sangría"></button>
                                            <button class="ql-indent" value="+1" title="Aumentar sangría"></button>
                                            <select class="ql-align" title="Alineación"></select>
                                        </span>
                                        <span class="ql-formats">
                                            <button class="ql-link" title="Añadir enlace"></button>
                                            <button class="ql-image" title="Añadir imagen"></button>
                                        </span>
                                        <span class="ql-formats">
                                            <button class="ql-clean" title="Limpiar formato"></button>
                                        </span>
                                    </f:facet>
                                </p:textEditor>
                                <p:messages for="editortexto" autoUpdate="true" closable="true" />
                                <h5><h:outputText value="Conclusiones y propuestas."/></h5>
                                <p:textEditor id="editorconclusiones" value="#{informeBean.mapaRespuestas[subarea][1]}" height="300" style="margin-bottom:10px" converter="#{trimConverter}">
                                     <f:facet name="toolbar">
                                        <span class="ql-formats">
                                            <select class="ql-font" title="Tipo de letra"></select>
                                            <select class="ql-size" title="Tamaño de letra">
                                                <option value="small">Pequeña</option>
                                                <option selected="selected">Normal</option>
                                                <option value="large">Grande</option>
                                            </select>
                                        </span>
                                         <span class="ql-formats">
                                            <button class="ql-bold" title="Negrita"></button>
                                            <button class="ql-italic" title="Cursiva"></button>
                                            <button class="ql-underline" title="Subrayado"></button>
                                            <button class="ql-strike" title="Tachado"></button>
                                        </span>
                                        <span class="ql-formats">
                                            <select class="ql-color ql-picker ql-color-picker" title="Color letra"></select>
                                            <select class="ql-background ql-picker ql-color-picker" title="Color fondo"></select>
                                        </span>
                                        <span class="ql-formats">
                                            <button class="ql-script" value="sub" title="Subíndice"></button>
                                            <button class="ql-script" value="super" title="Superíndice"></button>
                                        </span>
                                        <span class="ql-formats">
                                            <select  class="ql-header" title="Encabezado">
                                                <option selected="selected">Normal</option>
                                                <option value="3">Título 3</option>
                                                <option value="4">Título 4</option>
                                            </select>
                                        </span>
                                        <span class="ql-formats">
                                            <button class="ql-list" value="ordered" title="Lista numerada"></button>
                                            <button class="ql-list" value="bullet" title="Lista no numerada"></button>
                                            <button class="ql-indent" value="-1" title="Disminuir sangría"></button>
                                            <button class="ql-indent" value="+1" title="Aumentar sangría"></button>
                                            <select class="ql-align" title="Alineación"></select>
                                        </span>
                                        <span class="ql-formats">
                                            <button class="ql-link" title="Añadir enlace"></button>
                                            <button class="ql-image" title="Añadir imagen"></button>
                                        </span>
                                        <span class="ql-formats">
                                            <button class="ql-clean" title="Limpiar formato"></button>
                                        </span>
                                    </f:facet>
                                </p:textEditor>
                                <p:messages for="editorconclusiones" autoUpdate="true" closable="true" />
                            </p:outputPanel>
                        </p:tab>
					</p:accordionPanel>
				</p:tab>
			</p:accordionPanel>
            
            <div class="botonesFormulario">
                <p:commandButton value="Guardar" action="#{informeBean.guardarInforme}" icon="fa fa-save" />
                <p:commandButton value="Guardar y liberar mis asignaciones" action="#{informeBean.desasignarInforme}" icon="fa fa-save" />
                <p:commandButton value="Finalizar" action="#{informeBean.finalizarInforme}" icon="fa fa-check" rendered="#{esJefeEquipoInspeccion}"/>
                <p:button value="Volver" icon="fa fa-fw fa-undo" outcome="/informes/informes" />
            </div>
            <p:dialog id="dialog" widgetVar="dialogMessage" header="INFO" closable="false">
                <p:messages for="dialogMessage" autoUpdate="true" showDetail="true" showSummary="true" />
                <div class="centrarBotonesDialog">
                    <p:button value="Cerrar" onclick="PF('dialogMessage').hide()" />
                </div>
            </p:dialog>
        </h:form>

    </ui:define>
</ui:composition>