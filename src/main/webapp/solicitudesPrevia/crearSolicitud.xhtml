<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">
<f:view>
	<ui:composition template="../layouts/layoutInterior.xhtml">
		<ui:define name="content">

		<h:form>
		    <p:remoteCommand name="onload" action="#{solicitudDocPreviaBean.getFormularioCrearSolicitud}" update="datosReporte" autoRun="true" />
		</h:form>
		
			<h3>Datos Solicitud documentación</h3>
			<div class="aclaraciones">
				Los campos marcados con (*) son obligatorios
			</div>

			<h:form id="datosReporte">

				<p:growl id="growl" sticky="true" showDetail="true" />
				<p:wizard flowListener="#{solicitudDocPreviaBean.onFlowProcess}"
					nextLabel="Siguiente" backLabel="Atr&aacute;s">
					<div class="bloqueFormulario">
						<p:tab id="general" title="Datos contenido">
							<br></br>
							<p:panel header="Contenido">
								<br></br>
								<p:messages />
								<h:panelGrid columns="2" columnClasses="label, value">
								
									<h:outputLabel for="infoInspeccion" value="Nombre Unidad y Número Inspección (*):" />
									<p:autoComplete id="infoInspeccion" value="#{solicitudDocPreviaBean.solicitudDocumentacionPrevia.inspeccion}" completeMethod="#{solicitudDocPreviaBean.autocompletarInspeccion}"
				                        var="inspeccion" itemLabel="#{inspeccion.nombreUnidad} - #{inspeccion.numero}" itemValue="#{inspeccion}" converter="#{selectConverter}" forceSelection="true" 
				                        required="true" requiredMessage="Introduzca la unidad o el número de la inspección" onfocus="if (this.value == ' - '){this.value = '';}" queryDelay="1000">
				                        <p:ajax event="itemSelect" update="tipoInspeccion ambitoInspeccion" />
			                        </p:autoComplete>
			                        	
									<h:outputLabel for="tipoInspeccion" value="Carácter inspección:" />
									<p:inputText id="tipoInspeccion" value="#{solicitudDocPreviaBean.solicitudDocumentacionPrevia.inspeccion.tipoInspeccion.descripcion}" disabled="true"/>
																			
									<h:outputLabel for="ambitoInspeccion" value="Ámbito inspección:" />
									<p:inputText id="ambitoInspeccion" value="#{solicitudDocPreviaBean.solicitudDocumentacionPrevia.inspeccion.ambito}" disabled="true"/>
									
									<h:outputLabel for="asunto" value="Asunto (*):"/>
									<p:inputText id="asunto"
										value="#{solicitudDocPreviaBean.solicitudDocumentacionPrevia.asunto}"
										required="true" requiredMessage="Es obligatorio un asunto"
										converter="#{trimConverter}" />

									<h:outputLabel for="destinatario" value="Destinatario (*):"/>
									<p:inputText id="destinatario"
										value="#{solicitudDocPreviaBean.solicitudDocumentacionPrevia.destinatario}"
										required="true"
										requiredMessage="Es obligatorio un destinatario"
										converter="#{trimConverter}" />

									<h:outputLabel for="correoDestiantario" value="Correo destinatario (*):"/>
									<p:inputText id="correoDestiantario"
										value="#{solicitudDocPreviaBean.solicitudDocumentacionPrevia.correoDestinatario}"
										required="true"
										requiredMessage="Es obligatorio un correo del destinatario"
										validatorMessage="Formato de correo incorrecto"
										converter="#{trimConverter}">
										<f:validateRegex
											pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
									</p:inputText>

									<h:outputLabel for="cuatrimestre" value="Cuatrimestre (*):"/>
									<p:importEnum
										type="es.mira.progesin.persistence.entities.enums.CuatrimestreEnum"
										var="cuatrimestres" allSuffix="ALL_ENUM_VALUES" />
									<p:selectOneMenu id="cuatrimestre"
										value="#{solicitudDocPreviaBean.solicitudDocumentacionPrevia.cuatrimestre}"
										effect="fold" required="true"
										requiredMessage="Seleccione el cuatrimestre">
										<f:selectItem itemLabel="Seleccione uno: " itemValue="" />
										<f:selectItems value="#{cuatrimestres.ALL_ENUM_VALUES}"
											var="cuatrimestreSolicitudDocPrevia"
											itemLabel="#{cuatrimestreSolicitudDocPrevia.descripcion}"
											itemValue="#{cuatrimestreSolicitudDocPrevia}" />
									</p:selectOneMenu>

									<h:outputLabel for="anio" value="Año (*):"/>
									<p:inputNumber id="anio" value="#{solicitudDocPreviaBean.solicitudDocumentacionPrevia.anio}"
										required="true" requiredMessage="Es obligatorio un año"
										maxValue="9999" decimalSeparator=""
										thousandSeparator="" decimalPlaces="0" />

									<h:outputLabel for="fechaLimiteEnvio" value="Fecha límite envío documentación (*):"/>
									<p:calendar id="fechaLimiteEnvio"
										value="#{solicitudDocPreviaBean.solicitudDocumentacionPrevia.fechaLimiteEnvio}"
										pattern="dd/MM/yyyy"
										mindate="#{utilities.getCurrentDate()}"
										navigator="true" required="true"
										requiredMessage="Es obligatorio una fecha limite envío documentación" />

									<h:outputLabel for="fechaLimiteCumplimentar" value="Fecha límite cumplimentar cuestionario (*):"/>
									<p:calendar id="fechaLimiteCumplimentar"
										value="#{solicitudDocPreviaBean.solicitudDocumentacionPrevia.fechaLimiteCumplimentar}"
										pattern="dd/MM/yyyy"
										mindate="#{utilities.getCurrentDate()}"
										navigator="true" required="true"
										requiredMessage="Es obligatorio una fecha limite cumplimentar cuestionario"/>
										
									<h:outputLabel for="descargaPlantillas" value="Permitir descarga plantillas:" />
									<p:selectBooleanCheckbox id="descargaPlantillas" value="#{solicitudDocPreviaBean.solicitudDocumentacionPrevia.descargaPlantillas}" />
								</h:panelGrid>
							</p:panel>
						</p:tab>
						<p:tab id="documentacion" title="Documentación">
							<br></br>
							<p:panel header="documentacion">
								<br></br>
								<p:messages />
								<h:panelGrid columns="2" columnClasses="label, value">
									<p:dataTable id="documentosSolicitud" var="documento"
										value="#{solicitudDocPreviaBean.listadoDocumentos}"
										paginator="true" rows="20"
										selection="#{solicitudDocPreviaBean.documentosSelecionados}"
										rowKey="#{documento.idTipoDocumento}">
										<f:facet name="header">
								            Documentos previos cuestionario
								        </f:facet>
										<p:column selectionMode="multiple"
											style="width:16px;text-align:center" />

										<p:column headerText="Descripcion"
											style="font-weight: normal;"
											sortBy="#{documento.descripcion}"
											filterBy="#{documento.descripcion}">
											<h:outputText value="#{documento.descripcion}" />
										</p:column>
									</p:dataTable>

								</h:panelGrid>
							</p:panel>
						</p:tab>

						<p:tab id="apoyo" title="Apoyo">
							<br></br>
							<p:panel header="Apoyo">
								<br></br>
								<p:messages />
								
								<div class="aclaraciones">
									Los campos en blanco serán rellenados con los datos de la persona de apoyo por defecto.
								</div>
									
								<h:panelGrid columns="2" columnClasses="label, value">

									<h:outputLabel for="apoyoPuesto" value="Puesto persona apoyo:"
										style="font-weight: normal;" />
									<p:inputText id="apoyoPuesto"
										value="#{solicitudDocPreviaBean.solicitudDocumentacionPrevia.apoyoPuesto}"
										converter="#{trimConverter}" />

									<h:outputLabel for="apoyoNombre" value="Nombre persona apoyo:"
										style="font-weight: normal;" />
									<p:inputText id="apoyoNombre"
										value="#{solicitudDocPreviaBean.solicitudDocumentacionPrevia.apoyoNombre}"
										converter="#{trimConverter}" />

									<h:outputLabel for="apoyoTelefono"
										value="Teléfono persona apoyo:" style="font-weight: normal;" />
									<p:inputText id="apoyoTelefono"
										value="#{solicitudDocPreviaBean.solicitudDocumentacionPrevia.apoyoTelefono}"
										converter="#{trimConverter}" />

									<h:outputLabel for="apoyoCorreo" value=" Correo persona apoyo:"
										style="font-weight: normal;" />
									<p:inputText id="apoyoCorreo"
										value="#{solicitudDocPreviaBean.solicitudDocumentacionPrevia.apoyoCorreo}"
										validatorMessage="Formato de correo incorrecto"
										converter="#{trimConverter}">
										<f:validateRegex
											pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
									</p:inputText>

								</h:panelGrid>
							</p:panel>
						</p:tab>
						<p:tab id="confirm" title="Confirmar">
							<br></br>
							<p:panel header="Confirmar">
								<br></br>
								<h:panelGrid id="confirmation" columns="3"
									columnClasses="grid,grid,grid">
									<h:panelGrid columns="2" columnClasses="label,value">

										<h:outputText
											value="Creación solicitud documentación previa cuestionario: "
											style="font-weight: normal;" />

									</h:panelGrid>
								</h:panelGrid>
								<div class="botonesFormulario">
									<p:commandButton
										actionListener="#{solicitudDocPreviaBean.crearSolicitud}"
										value="Crear solicitud documentación previa"
										icon="fa fa-fw fa-user-plus" />
									<p:button outcome="/solicitudesPrevia/busquedaSolicitudesDocPrevia"
										value="Cancelar" icon="fa fa-fw fa-undo" />
								</div>
								<p:dialog id="dialog" widgetVar="dialogMessage" header="INFO">
									<p:ajax event="close"
										listener="#{facesUtilities.redirect('/solicitudesPrevia/busquedaSolicitudesDocPrevia')}" />
									<p:messages for="dialogMessage" autoUpdate="true"
										showDetail="true" showSummary="true" />
									<div class="centrarBotonesDialog">
										<p:commandButton value="Cerrar"
											actionListener="#{facesUtilities.redirect('/solicitudesPrevia/busquedaSolicitudesDocPrevia')}" />
									</div>
								</p:dialog>
							</p:panel>
						</p:tab>
					</div>
				</p:wizard>
			</h:form>
		</ui:define>
	</ui:composition>
</f:view>
</html>
